<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Missions ‚Äî ACSRS</title>
<link rel="preconnect" href="https://www.gstatic.com">
<style>
:root{
  --bg:#0b0f14; --panel:#121821; --line:#223044; --text:#e8eef5; --muted:#9fb2c9; --accent:#3a8bf2;
  --ok:#2ecc71; --warn:#f1c40f; --bad:#e74c3c; --info:#00c2ff; --rose:#ff5db1; --orange:#ffa447;
}
html,body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,Segoe UI,Arial,sans-serif}
.wrap{max-width:1400px;margin:0 auto;padding:16px}
.topbar{display:flex;justify-content:space-between;align-items:center}
h1{margin:0}
.btn{background:var(--accent);border:0;border-radius:8px;padding:10px 14px;color:#fff;font-weight:700;cursor:pointer}
.btn.ghost{background:#0f1520;border:1px solid #2c3d52}
.btn.warn{background:var(--warn);color:#000}
.btn.bad{background:var(--bad)}
.card{background:var(--panel);border:1px solid var(--line);border-radius:12px;padding:16px;margin-top:12px}
label{display:block;font-size:12px;color:var(--muted);margin:6px 0}
input,select,textarea{width:100%;padding:9px;border-radius:8px;border:1px solid #2c3d52;background:#0f1520;color:#fff;box-sizing:border-box}
textarea{min-height:70px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px}
.table{width:100%;border-collapse:collapse}
th,td{border:1px solid var(--line);padding:8px;vertical-align:top}
th{background:#182030}
.small{font-size:12px;color:var(--muted)}
.badge{display:inline-block;background:#0f1520;border:1px solid #2c3d52;border-radius:999px;padding:2px 8px;font-size:12px;margin-left:6px}
.kp{display:inline-flex;gap:6px;flex-wrap:wrap}
.kp button{background:#0f1520;border:1px solid #2c3d52;border-radius:8px;padding:6px 10px;color:#e8eef5;cursor:pointer}
.kp button.active{background:var(--accent)}
.row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
@media (max-width:1000px){ .row{grid-template-columns:1fr} }

/* Modal (wizard) */
.modal-back{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center;z-index:1000}
.modal{width:min(980px,96vw);max-height:92vh;overflow:auto;background:#0f1520;border:1px solid #2c3d52;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.45)}
.mh{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;border-bottom:1px solid #223044}
.mh h2{margin:0}
.mc{padding:16px}
.mf{display:flex;justify-content:space-between;gap:8px;padding:12px 16px;border-top:1px solid #223044}
.stepper{display:flex;gap:8px;margin-bottom:12px}
.step{padding:6px 10px;border-radius:999px;border:1px solid #2c3d52;background:#111a27;font-size:12px;color:#cfe1ff}
.step.active{background:var(--accent);border-color:var(--accent);color:#fff}
.toast{margin-left:8px}

/* Pills statut renfort */
.rstat{display:inline-block;border:1px solid #2c3d52;border-radius:999px;padding:2px 8px;font-size:12px;margin-left:6px}
.r-ok{background:#122b19;border-color:#2ecc71;color:#bdf2cd}
.r-warn{background:#2b2712;border-color:#f1c40f;color:#ffec9a}
</style>
</head>
<body>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<!-- Bridge + Guard + Page JS -->
<script src="js/store-bridge.js"></script>
<script src="js/auth-guard.js"></script>
<script>AuthGuard.ensureAuthOrRedirect();</script>
<script src="js/missions.js" defer></script>

<div class="wrap">
  <div class="topbar">
    <h1>Missions</h1>
    <div>
      <button class="btn" id="btnNew">‚ûï Nouvelle mission</button>
      <button class="btn ghost" onclick="location.href='dispatch.html'">Dispatch</button>
      <button class="btn ghost" onclick="location.href='tv-missions.html'">TV Missions</button>
    </div>
  </div>

  <div class="card">
    <h2>Missions en cours</h2>
    <table class="table" id="tblActive">
      <thead>
        <tr>
          <th style="width:70px">#</th>
          <th>V√©hicule</th>
          <th>Motif</th>
          <th>Lieu PEC</th>
          <th>Renforts</th>
          <th>Statuts</th>
          <th>Km</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody><!-- JS --></tbody>
    </table>
  </div>

  <div class="card">
    <div class="row" style="align-items:center">
      <h2 style="margin:0">Missions du jour (cl√¥tur√©es)</h2>
      <div style="text-align:right">
        <button class="btn warn" id="btnDeleteDone">üóë Supprimer la s√©lection (Admin)</button>
      </div>
    </div>
    <table class="table" id="tblDone">
      <thead>
        <tr>
          <th style="width:32px"></th>
          <th>V√©hicule</th>
          <th>Type</th>
          <th>Motif</th>
          <th>Œî km</th>
          <th>Heures</th>
        </tr>
      </thead>
      <tbody><!-- JS --></tbody>
    </table>
  </div>
</div>

<!-- Modal (wizard) -->
<div class="modal-back" id="modalBack" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="wizTitle">
    <div class="mh">
      <h2 id="wizTitle">Nouvelle mission</h2>
      <button class="btn bad" id="wizClose" type="button">Fermer</button>
    </div>
    <div class="mc">
      <div class="stepper" id="stepper">
        <div class="step" data-step="1">1. Type & v√©hicule</div>
        <div class="step" data-step="2">2. Motif & lieu PEC</div>
        <div class="step" data-step="3">3. 112 / Renforts</div>
        <div class="step" data-step="4">4. R√©cap & cr√©ation</div>
      </div>

      <!-- √âtape 1 -->
      <div class="grid wiz" data-step="1">
        <div>
          <label>Type</label>
          <select id="w_type">
            <option value="">‚Äî</option>
            <option>112</option>
            <option>TMS</option>
            <option>Pr√©vention</option>
            <option>Logistique</option>
          </select>
        </div>
        <div>
          <label>V√©hicule</label>
          <select id="w_veh"></select>
        </div>
        <div>
          <label>Attribution (auto)</label>
          <input id="w_attr" readonly>
        </div>
      </div>

      <!-- √âtape 2 -->
      <div class="grid wiz" data-step="2" style="display:none">
        <div>
          <label>Motif</label>
          <input id="w_motif" placeholder="Ex: Malaise, transfert‚Ä¶">
        </div>
        <div class="grid" style="grid-template-columns:repeat(2,1fr);gap:12px">
          <div><label>Rue</label><input id="w_rue"></div>
          <div><label>N¬∞ / Bo√Æte</label><input id="w_num"></div>
          <div><label>Code postal</label><input id="w_cp" maxlength="4"></div>
          <div><label>Localit√©</label><input id="w_ville" placeholder="Auto si CP connu"></div>
        </div>
      </div>

      <!-- √âtape 3 -->
      <div class="grid wiz" data-step="3" style="display:none">
        <div id="blk112" style="display:none">
          <label>Centrale 112</label>
          <select id="w_centrale">
            <option value="">‚Äî</option>
            <option>Mons</option><option>Namur</option><option>Arlon</option>
            <option>Li√®ge</option><option>Leuven</option><option>Bruxelles</option><option>Autres</option>
          </select>
          <label>Num√©ro mission (4 derniers)</label>
          <input id="w_num112" maxlength="4" placeholder="xxxx">
          <label>D√©part</label>
          <select id="w_depart112"><option>Normal</option><option>M√©dical</option></select>
        </div>

        <div>
          <label>Renforts √† pr√©voir</label>
          <div class="kp">
            <label><input type="checkbox" id="rf_pompiers"> Pompiers</label>
            <label><input type="checkbox" id="rf_police"> Police</label>
            <label><input type="checkbox" id="rf_smur"> SMUR</label>
            <label><input type="checkbox" id="rf_ambu112"> Ambu 112</label>
            <label><input type="checkbox" id="rf_racs"> RACS</label>
          </div>
          <div class="small">Le statut ‚ÄúAppel‚Äù sera pos√© sur les renforts coch√©s au moment de la cr√©ation (m√™me heure que l‚Äôappel mission). Vous pourrez compl√©ter ‚ÄúSur place‚Äù et commenter ensuite.</div>
        </div>
      </div>

      <!-- √âtape 4 -->
      <div class="wiz" data-step="4" style="display:none">
        <div class="card" style="margin:0">
          <div id="w_recap">‚Äî</div>
        </div>
      </div>
    </div>
    <div class="mf">
      <div class="small" id="wizMsg"></div>
      <div>
        <button class="btn ghost" id="wizPrev" type="button">‚óÄ Pr√©c√©dent</button>
        <button class="btn" id="wizNext" type="button">Suivant ‚ñ∂</button>
        <button class="btn" id="wizCreate" type="button" style="display:none">Cr√©er la mission</button>
      </div>
    </div>
  </div>
</div>

</body>
</html>
