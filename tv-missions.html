<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>TV — Missions en cours</title>

<!-- Leaflet (OpenStreetMap) -->
<link rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
  crossorigin="">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
  crossorigin=""></script>

<style>
:root{
  --bg:#0b0f14; --panel:#121821; --line:#223044;
  --text:#e8eef5; --muted:#9fb2c9; --accent:#3a8bf2;
  --ticker-bg:#b00020; --ticker-fg:#ffffff;
}
html,body{margin:0;height:100%;background:var(--bg);color:var(--text);font-family:Inter,Segoe UI,Arial,sans-serif;overflow:hidden}

.header{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:#0d131c;border-bottom:1px solid var(--line)}
.title{font-size:26px;font-weight:800}
.meta{display:flex;gap:12px;align-items:center}
.pill{background:#0f1520;border:1px solid #2c3d52;border-radius:999px;padding:6px 12px;color:#cfe1ff}

.wrap{display:grid;grid-template-rows:auto 1fr auto;height:100vh}
.main{display:grid;grid-template-columns:35% 65%;gap:12px;padding:12px;height:100%;box-sizing:border-box}

.listPanel{background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:10px;display:flex;flex-direction:column;min-height:0}
.listHeader{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
.count{color:#cfe1ff}
.list{overflow:auto;display:flex;flex-direction:column;gap:10px}
.card{background:#0f1520;border:1px solid #2c3d52;border-radius:12px;padding:10px;display:flex;gap:10px;align-items:flex-start}
.order{min-width:36px;height:36px;border-radius:8px;background:#162337;border:1px solid #2c3d52;display:flex;align-items:center;justify-content:center;font-weight:800;color:#9ec4ff}
.info{flex:1;display:flex;flex-direction:column;gap:6px}
.line{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.badge{font-size:12px;border:1px solid #2c3d52;border-radius:999px;padding:2px 8px;background:#0f1520;color:#cfe1ff}
.label{color:var(--muted)}

.st{font-weight:700;border-radius:999px;padding:2px 10px;border:1px solid #2c3d52}
.st-dispo{background:#00a032;color:#fff;border-color:#007a25}
@keyframes blinkDepart{0%,49%{background:#005DFF}50%,100%{background:#003EAD}}
.st-depart{animation:blinkDepart 1.2s linear infinite;color:#fff;border-color:#002e84}
.st-surplace{background:#ffd500;color:#000;border-color:#c7aa00}
.st-encharge{background:#ff75a0;color:#000;border-color:#d2567e}
.st-hopital{background:#ff7f00;color:#000;border-color:#cc6400}
.st-indispo{background:#c00000;color:#fff;border-color:#780000}

.mapPanel{background:var(--panel);border:1px solid var(--line);border-radius:14px;display:flex;flex-direction:column;min-height:0}
#map{flex:1;min-height:0;border-radius:12px;margin:10px}

.ticker{height:52px;background:var(--ticker-bg);color:var(--ticker-fg);display:flex;align-items:center;overflow:hidden;border-top:1px solid #7a0016}
.marquee{white-space:nowrap;display:flex;gap:96px;width:100%}
.scroll{display:flex;gap:96px;will-change:transform;animation:scroll 40s linear infinite}
@keyframes scroll{from{transform:translateX(0)} to{transform:translateX(-50%)}}
.sepchar{display:inline-block;padding:0 36px;color:#ffdede;opacity:.9}

#bootError{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:#0b0f14;color:#fff}
#bootError .box{background:#3b0d0d;border:1px solid #7a0016;border-radius:12px;padding:18px 22px;max-width:720px}
</style>
</head>
<body>
<div class="wrap">
  <div class="header">
    <div class="title">Missions en cours</div>
    <div class="meta">
      <div class="pill" id="clock">--:--</div>
      <div class="pill" id="count">0 mission(s)</div>
    </div>
  </div>

  <div class="main">
    <div class="listPanel">
      <div class="listHeader"><div class="count" id="subTitle">—</div></div>
      <div class="list" id="list"></div>
    </div>
    <div class="mapPanel"><div id="map"></div></div>
  </div>

  <div class="ticker">
    <div class="marquee">
      <div id="band1" class="scroll"></div>
      <div id="band2" class="scroll" aria-hidden="true"></div>
    </div>
  </div>
</div>

<div id="bootError">
  <div class="box">
    <div style="font-size:18px;font-weight:800;margin-bottom:6px">Connexion requise</div>
    <div style="opacity:.9">
      Échec d’authentification Firebase pour l’affichage TV.<br>
      Vérifie l’utilisateur <b>centrale@acsrs.be</b>, son mot de passe et les règles Database, puis recharge la page.
    </div>
  </div>
</div>

<!-- Firebase compat SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-database-compat.js"></script>
<script>
  // Config RACS
  const firebaseConfig = {
    apiKey: "AIzaSyCP6ZClAectP8OPneAeoYGYdRYO0CvnbnQ",
    authDomain: "racs-dispatch.firebaseapp.com",
    databaseURL: "https://racs-dispatch-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "racs-dispatch",
    storageBucket: "racs-dispatch.firebasestorage.app",
    messagingSenderId: "589135271261",
    appId: "1:589135271261:web:d080a5da49a061929b84b4"
  };
  if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);

  // Connexion email / mot de passe AVANT de charger store-bridge + tv-missions.js
  (async ()=>{
    try{
      // Déjà connecté ?
      let user = firebase.auth().currentUser;
      if (!user) {
        const cred = await firebase.auth().signInWithEmailAndPassword(
          "centrale@acsrs.be",
          "Password01$"
        );
        user = cred.user;
      }

      // Injecte les scripts après login
      const add = (src)=> new Promise((res,rej)=>{
        const s=document.createElement('script'); s.src=src; s.onload=res; s.onerror=rej; document.body.appendChild(s);
      });
      await add('js/store-bridge.js');
      await add('js/tv-missions.js');
    }catch(e){
      console.error('[tv-missions] Auth/boot error', e);
      document.getElementById('bootError').style.display='flex';
    }
  })();
</script>
</body>
</html>
