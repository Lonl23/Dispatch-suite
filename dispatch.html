<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Dispatch — ACSRS</title>
<style>
:root{
  --bg:#0b0f14; --panel:#121821; --line:#223044; --text:#e8eef5; --muted:#93a7bf; --accent:#3a8bf2;
  --ok:#2ecc71; --warn:#f1c40f; --bad:#e74c3c; --info:#00c2ff;
}
html,body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,Segoe UI,Arial,sans-serif}
.wrap{max-width:1400px;margin:0 auto;padding:16px}
.topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
h1{margin:0}
.btn{background:var(--accent);border:0;border-radius:8px;padding:10px 14px;color:#fff;font-weight:700;cursor:pointer}
.btn.ghost{background:#0f1520;border:1px solid #2c3d52}
.card{background:var(--panel);border:1px solid var(--line);border-radius:12px;padding:16px;margin-top:12px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:12px}
label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
input,select,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid #2c3d52;background:#0f1520;color:#fff;box-sizing:border-box}
textarea{min-height:72px;resize:vertical}
.small{color:var(--muted);font-size:12px}
.table{width:100%;border-collapse:collapse}
th,td{border:1px solid var(--line);padding:8px;text-align:left;vertical-align:top}
th{background:#182030;position:sticky;top:0;z-index:1}
.mut{color:var(--muted)}
.badge{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid #2c3d52;background:#0f1520;font-size:12px}
.status-dot{display:inline-block;width:10px;height:10px;border-radius:50%;margin-right:6px;vertical-align:baseline}
.st-Dispo{background:var(--ok)}
.st-Sorti{background:var(--info)}
.st-Indispo{background:var(--bad)}
.toast{font-size:13px;margin-top:6px}
.ok{color:#9fe3b1}
.err{color:#ffd1cf}
</style>
</head>
<body>

<!-- Firebase SDK (compat) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<!-- Bridge + Guard + Page JS -->
<script src="js/store-bridge.js"></script>
<script src="js/auth-guard.js"></script>
<script>AuthGuard.ensureAuthOrRedirect();</script>
<script src="js/dispatch.js" defer></script>

<div class="wrap">
  <div class="topbar">
    <h1>Dispatch</h1>
    <div>
      <button class="btn ghost" type="button" onclick="location.href='index.html'">Accueil</button>
      <button class="btn ghost" type="button" onclick="location.href='parametres.html'">Paramètres</button>
      <button class="btn ghost" type="button" onclick="location.href='tv-grid.html'">TV Grid</button>
      <button class="btn ghost" type="button" onclick="location.href='missions.html'">Missions</button>
    </div>
  </div>

  <div class="card">
    <h2>Rôles de commandement</h2>
    <div class="grid">
      <div><label>Officier de semaine</label><input id="r_off_sem" placeholder="Nom"></div>
      <div><label>Officier de garde</label><input id="r_off_gar" placeholder="Nom"></div>
      <div><label>Responsable opérations</label><input id="r_resp_ops" placeholder="Nom"></div>
      <div><label>Chef de groupe</label><input id="r_chef_grp" placeholder="Nom"></div>
      <div><label>Chef de poste</label><input id="r_chef_poste" placeholder="Nom"></div>
      <div><label>1er centraliste</label><input id="r_cent1" placeholder="Nom"></div>
      <div><label>2e centraliste</label><input id="r_cent2" placeholder="Nom"></div>
    </div>
    <div style="margin-top:10px">
      <button class="btn" id="btnSaveRoles" type="button">Enregistrer les rôles</button>
      <span class="small" id="rolesInfo"></span>
    </div>
  </div>

  <div class="card">
    <h2>Notes de garde</h2>
    <div class="grid">
      <div>
        <label>Matériel à récupérer</label>
        <textarea id="note_materiel" placeholder="Ex: Seringues, perfusions, oxygène…"></textarea>
      </div>
      <div>
        <label>Informations & remarques</label>
        <textarea id="note_infos" placeholder="Ex: Attention route barrée, consigne équipe…"></textarea>
      </div>
    </div>
    <div style="margin-top:10px">
      <button class="btn" id="btnSaveNotes" type="button">Enregistrer les notes</button>
      <span class="small" id="notesInfo"></span>
    </div>
  </div>

  <div class="card" style="overflow:auto;max-height:62vh">
    <h2 style="margin-top:0">Tableau de garde</h2>
    <table class="table">
      <thead>
        <tr>
          <th style="min-width:180px">Véhicule</th>
          <th>Attribution</th>
          <th>Chauffeur</th>
          <th>Soins</th>
          <th>3ᵉ homme</th>
          <th style="min-width:130px">Statut</th>
          <th style="min-width:110px">Km</th>
          <th>Commentaire</th>
        </tr>
      </thead>
      <tbody id="tblBody"><!-- JS --></tbody>
    </table>
    <div class="small mut" id="dbg"></div>
  </div>

  <div class="small toast" id="toaster"></div>
</div>
</body>
</html>
