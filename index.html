<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Accueil ‚Äì Dispatch</title>
<style>
  :root{--bg:#071022;--panel:#0f1724;--line:#213243;--txt:#eef3fb;--mut:#9fb3d0;--accent:#2f7bf6}
  html,body{margin:0;background:var(--bg);color:var(--txt);font-family:Segoe UI,Inter,Arial,sans-serif}
  .wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}
  .card{background:var(--panel);padding:22px;border-radius:14px;border:1px solid var(--line);box-shadow:0 6px 30px rgba(0,0,0,.5)}
  h1{margin:0 0 12px;font-size:22px}
  label{font-size:13px;color:var(--mut)}
  input{width:100%;padding:10px;border-radius:8px;border:1px solid var(--line);background:#081427;color:#fff;margin-top:6px;margin-bottom:12px}
  button,.btn{display:inline-block;text-decoration:none;text-align:center;cursor:pointer;background:var(--accent);color:#fff;border:0;border-radius:10px;padding:10px 14px;font-weight:700}
  .mut{color:var(--mut);font-size:13px}
  .menu{display:grid;grid-template-columns:1fr;gap:14px;min-width:260px}
  .hidden{display:none}
  .topbar{position:fixed;top:0;left:0;right:0;background:#0b1426;border-bottom:1px solid var(--line);padding:8px 14px;display:flex;justify-content:space-between;align-items:center}
  .logout{background:#b23b3b}
</style>
</head>
<body>

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>

<div id="topbar" class="topbar hidden">
  <div><b>Dispatch</b> ‚Äî connect√© : <span id="who"></span></div>
  <button class="btn logout" onclick="logout()">D√©connexion</button>
</div>

<div class="wrap">
  <div id="loginCard" class="card" style="width:360px">
    <h1>Connexion</h1>
    <label>Email</label>
    <input id="email" type="email" placeholder="centrale@acsrs.be" />
    <label>Mot de passe</label>
    <input id="password" type="password" placeholder="********" />
    <button id="btnLogin">Se connecter</button>
    <p id="msg" class="mut" style="margin-top:10px"></p>
  </div>

  <div id="menuCard" class="card hidden">
    <h1>Choisir un mode</h1>
    <div class="menu">
      <a class="btn" href="dispatch.html">üõ†Ô∏è Dispatch </a>
      <a class="btn" href="parametres.html" target="_blank">‚öôÔ∏è Param√©trages </a>
      <a class="btn" href="tv-grid.html" target="_blank">üì∫ Tableau de garde </a>
      <a class="btn" href="missions.html" target="_blank"> Encodage missions</a>
      <a class="btn" href="tv-missions.html" target="_blank"> Missions en cours</a>

    </div>
  </div>
</div>

<script>
/* Remplace par TA config Firebase */
const firebaseConfig = {
  apiKey: "AIzaSyCP6ZClAectP8OPneAeoYGYdRYO0CvnbnQ",
  authDomain: "racs-dispatch.firebaseapp.com",
  databaseURL: "https://racs-dispatch-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "racs-dispatch",
  storageBucket: "racs-dispatch.firebasestorage.app",
  messagingSenderId: "589135271261",
  appId: "1:589135271261:web:d080a5da49a061929b84b4"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();

const loginCard = document.getElementById('loginCard');
const menuCard  = document.getElementById('menuCard');
const msg       = document.getElementById('msg');
const whoSpan   = document.getElementById('who');
const topbar    = document.getElementById('topbar');

document.getElementById('btnLogin').onclick = async ()=>{
  msg.textContent = "Connexion‚Ä¶";
  try{
    const email = document.getElementById('email').value.trim();
    const pass  = document.getElementById('password').value;
    const res   = await auth.signInWithEmailAndPassword(email, pass);
    const idTok = await res.user.getIdToken(true);
    localStorage.setItem("dispatch_idToken", idTok);
    localStorage.setItem("dispatch_uid", res.user.uid);
    localStorage.setItem("dispatch_email", res.user.email || "");
    showMenu(res.user);
  }catch(e){
    console.error(e);
    msg.textContent = e.message || "Erreur de connexion";
  }
};

function showMenu(user){
  whoSpan.textContent = user.email || user.uid;
  topbar.classList.remove('hidden');
  loginCard.classList.add('hidden');
  menuCard.classList.remove('hidden');
}

function showLogin(){
  topbar.classList.add('hidden');
  menuCard.classList.add('hidden');
  loginCard.classList.remove('hidden');
}

function logout(){
  localStorage.removeItem("dispatch_idToken");
  localStorage.removeItem("dispatch_uid");
  localStorage.removeItem("dispatch_email");
  auth.signOut().finally(()=>location.reload());
}

auth.onAuthStateChanged(async user=>{
  if(user){
    const t = await user.getIdToken();
    localStorage.setItem("dispatch_idToken", t);
    localStorage.setItem("dispatch_uid", user.uid);
    localStorage.setItem("dispatch_email", user.email || "");
    showMenu(user);
  }else{
    showLogin();
  }
});
</script>
</body>
</html>
