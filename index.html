<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Connexion - Dispatch</title>
<style>
  body{font-family:Segoe UI,Inter,Arial;background:#071022;color:#eef3fb;display:flex;align-items:center;justify-content:center;height:100vh;margin:0}
  .card{background:#0f1724;padding:22px;border-radius:12px;width:360px;box-shadow:0 6px 30px rgba(0,0,0,.6)}
  h1{margin:0 0 12px;font-size:20px}
  label{font-size:13px;color:#9fb3d0}
  input{width:100%;padding:10px;border-radius:8px;border:1px solid #213243;background:#071428;color:#fff;margin-top:6px;margin-bottom:12px}
  button{width:100%;padding:10px;border-radius:8px;border:0;background:#2f7bf6;color:#fff;font-weight:700}
  .muted{font-size:13px;color:#9fb3d0;margin-top:10px;text-align:center}
</style>
</head>
<body>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>

<div class="card">
  <h1>Connexion Dispatch</h1>
  <label>Email</label>
  <input id="email" type="email" value="centrale@acsrs.be" />
  <label>Mot de passe</label>
  <input id="password" type="password" value="Password01$" />
  <button id="btnLogin">Se connecter</button>
  <p class="muted" id="msg"></p>
</div>

<script>
  // ⚠️ Remplace par ta config Firebase
  const firebaseConfig = {
     apiKey: "AIzaSyCP6ZClAectP8OPneAeoYGYdRYO0CvnbnQ",
     authDomain: "racs-dispatch.firebaseapp.com",
     databaseURL: "https://racs-dispatch-default-rtdb.europe-west1.firebasedatabase.app",
     projectId: "racs-dispatch",
     storageBucket: "racs-dispatch.firebasestorage.app",
     messagingSenderId: "589135271261",
     appId: "1:589135271261:web:d080a5da49a061929b84b4"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();

  const emailInput = document.getElementById("email");
  const passInput  = document.getElementById("password");
  const msg = document.getElementById("msg");

  document.getElementById("btnLogin").onclick = async () => {
    msg.textContent = "Connexion...";
    try {
      const res = await auth.signInWithEmailAndPassword(emailInput.value.trim(), passInput.value);
      const user = res.user;
      const idToken = await user.getIdToken(/* forceRefresh */ true);
      // Stocke le token et l'uid en localStorage (utilisé par store-bridge.js)
      localStorage.setItem("dispatch_idToken", idToken);
      localStorage.setItem("dispatch_uid", user.uid);
      // Redirige vers dispatch
      window.location.href = "dispatch.html";
    } catch (err) {
      console.error(err);
      msg.textContent = "Erreur : " + (err.message || err.code);
    }
  };

  // Si déjà connecté, redirige
  auth.onAuthStateChanged(async u=>{
    if(u){
      const t = await u.getIdToken();
      localStorage.setItem("dispatch_idToken", t);
      localStorage.setItem("dispatch_uid", u.uid);
      // si on est déjà sur index, on peut rediriger
      if(location.pathname.endsWith("index.html") || location.pathname==="/" || location.pathname.endsWith("/")){
        window.location.href = "dispatch.html";
      }
    }
  });
</script>
</body>
</html>
